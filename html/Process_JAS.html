<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Ed Carnell (edcarn@ceh.ac.uk)" />


<title>Process JAS files</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Process JAS files</h1>
<h4 class="author">Ed Carnell (<a href="mailto:edcarn@ceh.ac.uk" class="email">edcarn@ceh.ac.uk</a>)</h4>
<h4 class="date">Tuesday 11 March 2025</h4>



<p><strong>Important Notes</strong></p>
<p><strong>This script processes sensitive information, which should not
be saved anywhere except for the dedicated P:/ folder or on the Oracle
Database. For any queries please talk to me (<a href="mailto:edcarn@ceh.ac.uk" class="email">edcarn@ceh.ac.uk</a>) or
Ulli (<a href="mailto:ud@ceh.ac.uk" class="email">ud@ceh.ac.uk</a>)</strong></p>
<div id="processing-jas-files-for-2023" class="section level1">
<h1>Processing JAS files for 2023</h1>
<div id="update-jas-census-look-up-table" class="section level2">
<h2>1 - Update JAS census look-up table</h2>
<p>This look-up table contains details on all the census items for 1990
- 2024 for each of the UK countries (i.e. England, Wales, Scotland and
Northern Ireland). This is an important stage as it’s important that any
new items (e.g. minor crops that previously were not included) are
included. The code below reads in the 2022 look-up table and updates the
database for 2023. If there are any new items, these should be added
here.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">require</span>(AgricInvUKCEH)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">require</span>(data.table)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">require</span>(magrittr)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">require</span>(units)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">require</span>(readxl)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co"># set user </span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>usr <span class="ot">&lt;-</span> <span class="st">&quot;Ed Carnell (edcarn@ceh.ac.uk)&quot;</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co"># set new emission year</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>prv_yr <span class="ot">&lt;-</span> <span class="dv">2022</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>nw_yr <span class="ot">&lt;-</span> prv_yr <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>updte_jas_lkup <span class="ot">&lt;-</span> F</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="cf">if</span>(updte_jas_lkup){</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>  </span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="co"># Read in 2022 look-up (from AgricInvUKCEH package)</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>jas_nw_yr <span class="ot">&lt;-</span> jas_lkup[YEAR <span class="sc">==</span> prv_yr,]</span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>                      </span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a><span class="co"># Update year column to 2023</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>jas_nw_yr[, YEAR <span class="sc">:=</span> nw_yr]</span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>jas_nw_yr[, LFA_ID <span class="sc">:=</span> <span class="fu">gsub</span>(prv_yr,nw_yr,LFA_ID)]</span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>jas_nw_yr[, UNIQUE_CODE <span class="sc">:=</span> <span class="fu">gsub</span>(prv_yr,nw_yr,UNIQUE_CODE)]</span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>jas_nw_yr[, CPH_ID <span class="sc">:=</span> <span class="fu">gsub</span>(prv_yr,nw_yr,CPH_ID)]</span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;/mount/projects1/08955_Agricultural_Emission_Inventory/2023_Inventory/2023_JAS_lookup_table/&quot;</span>)</span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a><span class="co">#fwrite(jas_nw_yr,&quot;2023_JAS_lookup_table.csv&quot;,row.names = F)</span></span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a>jas_nw_yr <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;2023_JAS_lookup_table.xlsx&quot;</span>,<span class="at">sheet =</span> <span class="st">&quot;2023_JAS_lookup_table&quot;</span>) <span class="sc">%&gt;%</span> as.data.table</span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a><span class="co"># Save to Oracle Database (SCF0102_JAS_LOOKUP)</span></span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">&quot;DELETE FROM SCF0102_JAS_LOOKUP WHERE YEAR = &quot;</span>,nw_yr) <span class="sc">%&gt;%</span> <span class="fu">agric_db_query</span>()</span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a>  </span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a><span class="fu">agric_update_tbl</span>(<span class="at">x =</span> jas_nw_yr,</span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a>                  <span class="at">tablename =</span> <span class="st">&quot;SCF0102_JAS_LOOKUP&quot;</span>,</span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a>                  <span class="at">appnd =</span> T)</span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a>jas_lkup <span class="ot">&lt;-</span> <span class="fu">rbind</span>(jas_lkup[YEAR <span class="sc">!=</span> nw_yr,],jas_nw_yr) <span class="sc">%&gt;%</span> unique</span>
<span id="cb1-44"><a href="#cb1-44" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" tabindex="-1"></a><span class="fu">save</span>(<span class="at">list =</span> <span class="st">&quot;jas_lkup&quot;</span>, <span class="at">file =</span> <span class="st">&quot;~/AgricInvUKCEH/data/jas_lkup.rda&quot;</span>)</span>
<span id="cb1-46"><a href="#cb1-46" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="find-jas-files-and-create-look-up-table" class="section level2">
<h2>2 - Find JAS files and create look up table</h2>
<p>The code below searches for CSV files stored in
<code>P:/08955_Agricultural_Emission_Inventory/JAS_Files/</code> and
prepares a look-up table (data.table object) that can be passed to
functions to create the holding location table (SCF0102_HOLDINGS_TEST)
and census value tables (e.g. SCF0102_ENG_CENSUS_VALS)</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>jas_dir <span class="ot">&lt;-</span> <span class="st">&quot;/mount/projects1/08955_Agricultural_Emission_Inventory/JAS_Files/&quot;</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co"># List original JAS files</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>JAS_file_ls <span class="ot">&lt;-</span>  jas_dir <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  </span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">d{4}.csv$&quot;</span>, <span class="at">recursive =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  </span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>            <span class="fu">data.table</span>(</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>              <span class="at">Country =</span> <span class="fu">regmatches</span>(., <span class="fu">regexpr</span>(<span class="st">&quot;^[^/]+&quot;</span>,.)),</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>              <span class="at">File =</span> <span class="fu">paste0</span>(jas_dir,.),</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>              <span class="at">YEAR =</span> <span class="fu">regmatches</span>(., <span class="fu">regexpr</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">d{4}&quot;</span>,.))) <span class="sc">%&gt;%</span> </span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>  </span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>                       .[,.(YEAR,</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>                            Country,</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>                            <span class="at">DAUTH =</span> <span class="fu">factor</span>(Country,<span class="fu">c</span>(<span class="st">&quot;England&quot;</span>,<span class="st">&quot;Wales&quot;</span>,<span class="st">&quot;Scotland&quot;</span>,<span class="st">&quot;Northern Ireland&quot;</span>),</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>                                           <span class="fu">c</span>(<span class="st">&quot;ENG&quot;</span>,<span class="st">&quot;W&quot;</span>,<span class="st">&quot;SC&quot;</span>,<span class="st">&quot;NI&quot;</span>)),File)]</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">YEAR</th>
<th align="left">Country</th>
<th align="left">DAUTH</th>
<th align="left">File</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>
<div id="process-holding-locations-for-england-wales-and-northern-ireland" class="section level2">
<h2>3 - Process Holding Locations for England, Wales and Northern
Ireland</h2>
<p>The function <code>agric_jas_csv_to_locations()</code> function
updates the holding location table based on the holding-level JAS
data.</p>
<p>The resulting table includes:</p>
<ul>
<li><p><strong>COUNTRY</strong> (numeric): Values range from 1-4
indicating the devolved authority that each holding is situated in,
where: 1 = England 2 = Wales 3 = Scotland 4 = Northern Ireland.</p></li>
<li><p><strong>HOLDING</strong> (character): The format of this field is
“#-##-###-####”, which indicates each holding’s
COUNTRY-COUNTY-PARISH-HOLDING ID. Each holding’s CPH number (GB; FCN for
NI) has been padded with zeros to a length of nine (9) to match
England’s system and has been prefixed with the country code defined
below.The Northern Ireland datasets were missing FCN (equivalent to a
CPH number) columns for 1993-1994. To gap-fill this data each holding’s
spatial position has been used to assign an FCN based on census data
from 1992/1995. For holdings that could not be matched to the 1992/1995
census, a new holding ID was supplied (values of 68001 to 68001 +
n-1).</p></li>
<li><p><strong>CELL</strong> (numeric): This field refers to the 10km
grid square ID (as defined in the new Agricultural Emission Inventory
model), with each holding allocated to a square.</p></li>
<li><p><strong>LFA</strong> (numeric): Least Favoured Area status
assigned by spatial intersection of holding coordinates and vector
dataset of LFA boundaries (by default), where an LFA status could not be
assigned, the LFA status assigned by the JAS is allocated.</p></li>
<li><p><strong>LFA_SHP</strong> (numeric): Least Favoured Area status
assigned by spatial intersection of holding coordinates and vector
dataset of LFA boundaries</p></li>
<li><p><strong>LFA_JAS</strong> (numeric): Least Favoured Area status
assigned JAS.</p></li>
<li><p><strong>YEAR</strong> (numeric): Specifying year of JAS activity
data</p></li>
<li><p><strong>COEFFREGION</strong> (numeric): This field refers to the
NUTS 1 region ID each holding belongs to. Regions were assigned to
holdings in England, as region-specific Standard Output (SO)
coefficients are applied in England for calculating Robust Farm Types
(RFTs).</p></li>
<li><p><strong>PARISH</strong> (numeric): Holdings were assigned a
parish ID for use in the high-resolution emission mapping carried out by
CEH. Each HOLDING/YEAR/COUNTRY combination.</p></li>
<li><p><strong>EASTING</strong> (numeric): Coordinates assocaiated with
holding (may be based on postcode centroids for Scotland or parish
centroids for early years).</p></li>
<li><p><strong>NORTHING</strong> (numeric): Coordinates assocaiated with
holding (may be based on postcode centroids for Scotland or parish
centroids for early years).</p></li>
<li><p><strong>XY</strong> (charcter): Flag associated with how the 10
km was assigned.</p></li>
</ul>
</div>
<div id="a-method-for-england-and-wales" class="section level2">
<h2>3a Method for England and Wales</h2>
<p>England and Wales are straightforward and require no pre-processing
of JAS CSVs.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>fl_lkup <span class="ot">&lt;-</span> JAS_file_ls[DAUTH <span class="sc">==</span> <span class="st">&quot;ENG&quot;</span> <span class="sc">&amp;</span> YEAR <span class="sc">==</span> nw_yr,]</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="fu">agric_jas_csv_to_locations</span>(fl_lkup)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co"># check update</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="fu">render_qaqc_doc</span>(<span class="at">out_fl =</span> <span class="st">&quot;~/QAQC_locations.html&quot;</span>, <span class="at">yr =</span> nw_yr, <span class="at">out_locs =</span> T)</span></code></pre></div>
</div>
<div id="b-method-for-scotland" class="section level2">
<h2>3b Method for Scotland</h2>
<p>Scotland’s holding locations are based on postcodes. These need
processing in a different way to England, Wales &amp; Northern Ireland
(where coordinates are used)</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>fl_lkup <span class="ot">&lt;-</span> JAS_file_ls[DAUTH <span class="sc">==</span> <span class="st">&quot;SC&quot;</span> <span class="sc">&amp;</span> YEAR <span class="sc">==</span> nw_yr,]</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="fu">agric_sc_jas_csv_to_locations</span>(fl_lkup)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co"># check update</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="fu">render_qaqc_doc</span>(<span class="at">out_fl =</span> <span class="st">&quot;~/QAQC_locations.html&quot;</span>, <span class="at">yr =</span> nw_yr, <span class="at">out_locs =</span> T)</span></code></pre></div>
</div>
<div id="c-method-for-northern-ireland" class="section level2">
<h2>3c Method for Northern Ireland</h2>
<p>As Northern Ireland’s holding coordinates are on the Irish National
Grid, these need adjusting before running the
<code>agric_jas_csv_to_locations</code> function. I adjust the JAS CSV
file as I find it easier than building it into a function (as the
columns change and some years have multiple sets of coordinates
e.g. based on UPRN vs Postcodes).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>fl_lkup <span class="ot">&lt;-</span> JAS_file_ls[DAUTH <span class="sc">==</span> <span class="st">&quot;NI&quot;</span> <span class="sc">&amp;</span> YEAR <span class="sc">==</span> nw_yr,] <span class="co"># The coordinates of this file are BNG</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="fu">agric_jas_csv_to_locations</span>(fl_lkup)</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co"># check update</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="fu">render_qaqc_doc</span>(<span class="at">out_fl =</span> <span class="st">&quot;~/QAQC_locations.html&quot;</span>, <span class="at">yr =</span> nw_yr, <span class="at">out_locs =</span> T)</span></code></pre></div>
<table>
<colgroup>
<col width="8%" />
<col width="15%" />
<col width="5%" />
<col width="4%" />
<col width="8%" />
<col width="8%" />
<col width="5%" />
<col width="13%" />
<col width="7%" />
<col width="8%" />
<col width="9%" />
<col width="4%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">COUNTRY</th>
<th align="left">HOLDING</th>
<th align="right">CELL</th>
<th align="right">LFA</th>
<th align="right">LFA_SHP</th>
<th align="right">LFA_JAS</th>
<th align="right">YEAR</th>
<th align="left">COEFF_REGION</th>
<th align="right">PARISH</th>
<th align="right">EASTING</th>
<th align="right">NORTHING</th>
<th align="left">XY</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">1-47-634-0002</td>
<td align="right">3666</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">2023</td>
<td align="left">UKE</td>
<td align="right">47634</td>
<td align="right">451010</td>
<td align="right">407670</td>
<td align="left">JAS</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">1-47-634-0006</td>
<td align="right">3666</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">2023</td>
<td align="left">UKE</td>
<td align="right">47634</td>
<td align="right">451600</td>
<td align="right">406980</td>
<td align="left">JAS</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">1-47-634-0009</td>
<td align="right">3666</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">2023</td>
<td align="left">UKE</td>
<td align="right">47634</td>
<td align="right">451500</td>
<td align="right">405570</td>
<td align="left">JAS</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">1-47-634-0018</td>
<td align="right">3666</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">2023</td>
<td align="left">UKE</td>
<td align="right">47634</td>
<td align="right">453840</td>
<td align="right">405060</td>
<td align="left">JAS</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">1-47-634-0067</td>
<td align="right">3666</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">2023</td>
<td align="left">UKE</td>
<td align="right">47634</td>
<td align="right">452126</td>
<td align="right">407966</td>
<td align="left">JAS</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">1-47-634-0078</td>
<td align="right">3666</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">2023</td>
<td align="left">UKE</td>
<td align="right">47634</td>
<td align="right">452750</td>
<td align="right">406220</td>
<td align="left">JAS</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">1-47-636-0006</td>
<td align="right">3666</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">2023</td>
<td align="left">UKE</td>
<td align="right">47636</td>
<td align="right">454429</td>
<td align="right">407429</td>
<td align="left">JAS</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">1-47-641-0036</td>
<td align="right">3666</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">2023</td>
<td align="left">UKE</td>
<td align="right">47641</td>
<td align="right">459860</td>
<td align="right">400830</td>
<td align="left">JAS</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">1-47-641-0158</td>
<td align="right">3666</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">2023</td>
<td align="left">UKE</td>
<td align="right">47641</td>
<td align="right">458450</td>
<td align="right">406080</td>
<td align="left">JAS</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">1-47-641-0171</td>
<td align="right">3666</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">2023</td>
<td align="left">UKE</td>
<td align="right">47641</td>
<td align="right">456111</td>
<td align="right">409111</td>
<td align="left">JAS</td>
</tr>
</tbody>
</table>
<div id="save-jas-cropgrass-areas-and-livestock-numbers-to-oracle-database-e.g.-scf0102_eng_census_vals" class="section level3">
<h3>4 - Save JAS crop/grass areas and livestock numbers to Oracle
Database (e.g. SCF0102_ENG_CENSUS_VALS)</h3>
<p>The function <code>agric_jas_csv_to_db()</code> function updates a
census values table (e.g. SCF0102_ENG_CENSUS_VALS). The table stores
values in their original Survey/Census categories.</p>
<p>The resulting table includes</p>
<ul>
<li><p><strong>HOLDING</strong> (character): The format of this field is
“#-##-###-####”, which indicates each holding’s
COUNTRY-COUNTY-PARISH-HOLDING ID. Each holding’s CPH number (GB; FCN for
NI) has been padded with zeros to a length of nine (9) to match
England’s system and has been prefixed with the country code defined
below.The Northern Ireland datasets were missing FCN (equivalent to a
CPH number) columns for 1993-1994. To gap-fill this data each holding’s
spatial position has been used to assign an FCN based on census data
from 1992/1995. For holdings that could not be matched to the 1992/1995
census, a new holding ID was supplied (values of 68001 to 68001 +
n-1).</p></li>
<li><p><strong>UNIQUE_CODE</strong> (character): Code corresponding to
census/survey question (with a unique ID per year/UK Country)</p></li>
<li><p><strong>VALUE</strong> (character): Holding total (per unique
code) for livestock this is recorded as heads (i.e. number of animals)
and for crops/grass in hectares</p></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">agric_jas_csv_to_db</span>(<span class="at">jas_lkup =</span> jas_lkup,<span class="at">fl_lkup =</span> fl_lkup)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">HOLDING</th>
<th align="left">UNIQUE_CODE</th>
<th align="right">VALUE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1-35-202-0007</td>
<td align="left">ENG_2023_G2</td>
<td align="right">4.55384</td>
</tr>
<tr class="even">
<td align="left">1-35-202-0012</td>
<td align="left">ENG_2023_G2</td>
<td align="right">33.20041</td>
</tr>
<tr class="odd">
<td align="left">1-35-202-0013</td>
<td align="left">ENG_2023_G2</td>
<td align="right">37.86000</td>
</tr>
<tr class="even">
<td align="left">1-35-202-0041</td>
<td align="left">ENG_2023_G2</td>
<td align="right">17.77000</td>
</tr>
<tr class="odd">
<td align="left">1-35-202-0048</td>
<td align="left">ENG_2023_G2</td>
<td align="right">26.46000</td>
</tr>
<tr class="even">
<td align="left">1-35-202-0050</td>
<td align="left">ENG_2023_G2</td>
<td align="right">0.27880</td>
</tr>
<tr class="odd">
<td align="left">1-35-202-0057</td>
<td align="left">ENG_2023_G2</td>
<td align="right">1.54089</td>
</tr>
<tr class="even">
<td align="left">1-35-203-0003</td>
<td align="left">ENG_2023_G2</td>
<td align="right">0.02100</td>
</tr>
<tr class="odd">
<td align="left">1-35-203-0013</td>
<td align="left">ENG_2023_G2</td>
<td align="right">82.82520</td>
</tr>
<tr class="even">
<td align="left">1-35-204-0001</td>
<td align="left">ENG_2023_G2</td>
<td align="right">0.12147</td>
</tr>
</tbody>
</table>
</div>
<div id="check-totals-with-rothamsted" class="section level3">
<h3>5 - Check totals with Rothamsted</h3>
<p>The next stage is checking with Rothamsted that our holding-level
statistics match official statistics.</p>
<p>Totals are reported separetely by UK Country: - England 2023: <a href="https://assets.publishing.service.gov.uk/media/651d464bbef21800156ded36/structure-june-eng-series-280923_v2.ods" class="uri">https://assets.publishing.service.gov.uk/media/651d464bbef21800156ded36/structure-june-eng-series-280923_v2.ods</a>
- Wales 2023: <a href="https://www.gov.wales/survey-agriculture-and-horticulture-june-2023" class="uri">https://www.gov.wales/survey-agriculture-and-horticulture-june-2023</a></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">c</span>(<span class="st">&quot;Eng&quot;</span>,<span class="st">&quot;W&quot;</span>,<span class="st">&quot;SC&quot;</span>,<span class="st">&quot;NI&quot;</span>), <span class="at">FUN =</span> <span class="cf">function</span>(dauth){</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">&quot;SELECT UNIQUE_CODE, SUM(VALUE) AS TOTAL FROM SCF0102_&quot;</span>,dauth,<span class="st">&quot;_CENSUS_VALS&quot;</span>,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>          <span class="st">&quot; WHERE UNIQUE_CODE LIKE &#39;%_&quot;</span>,nw_yr,<span class="st">&quot;_%&#39;&quot;</span>,</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>          <span class="st">&quot; GROUP BY UNIQUE_CODE&quot;</span>) <span class="sc">%&gt;%</span> agric_db_query}) <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind,.)</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co"># map values to lookup table</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>mpd_tots <span class="ot">&lt;-</span> <span class="fu">merge</span>(x,</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>                  <span class="at">y =</span> jas_lkup[,.(DAUTH,YEAR,UNIQUE_CODE,CENSUS_CATEGORY_DESC,DB_CATEGORY)], </span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>                  <span class="at">by =</span> <span class="st">&quot;UNIQUE_CODE&quot;</span>, <span class="at">all.x =</span> T)</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="fu">fwrite</span>(mpd_tots,</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>       <span class="st">&quot;/mount/projects1/08955_Agricultural_Emission_Inventory/2023_Inventory/JAS_Totals/jas23_tots.csv&quot;</span>,</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>       <span class="at">row.names =</span> F)</span></code></pre></div>
</div>
<div id="convert-jas-categories-to-oracle-database-table" class="section level3">
<h3>6 - Convert JAS Categories to Oracle Database Table</h3>
<p>The function <code>agric_update_actv_tbl()</code> queries the census
values table (e.g. SCF0102_ENG_CENSUS_VALS) for the sector specified and
updates a first-cut activity table. These tables are further processed
where categories need separating, e.g. where the category “Layers &amp;
Pullets” are recorded by the JAS but “Layers” and “Pullets” need
separating in the emission mode.</p>
<p>The resulting table includes</p>
<ul>
<li><p><strong>INVENTORY</strong> (numeric): This has been assigned the
value 1, for the United Kingdom</p></li>
<li><p><strong>YEAR</strong> (numeric): Specifying year of JAS activity
data</p></li>
<li><p><strong>HOLDING</strong> (character): The format of this field is
“#-##-###-####”, which indicates each holding’s
COUNTRY-COUNTY-PARISH-HOLDING ID. Each holding’s CPH number (GB; FCN for
NI) has been padded with zeros to a length of nine (9) to match
England’s system and has been prefixed with the country code defined
below. The Northern Ireland datasets were missing FCN (equivalent to a
CPH number) columns for 1993-1994. To gap-fill this data each holding’s
spatial position has been used to assign an FCN based on census data
from 1992/1995. For holdings that could not be matched to the 1992/1995
census, a new holding ID was supplied (values of 68001 to 68001 +
n-1).</p></li>
<li><p><strong>DB_CATEGORY</strong> (numeric): Intermediate database
category, the RFT calculation requires higher categorical resolution
than the emission model (for most categories) so further aggregation
(and separation for some livestock/crop) is required later.</p></li>
<li><p><strong>COUNT</strong> (character): Aggregated total of all JAS
categories mapped to DB_CATEGORY, for livestock this is recorded as
heads (i.e. number of animals) and for crops/grass in hectares</p></li>
<li><p><strong>COUNTRY</strong> (numeric): Values range from 1-4
indicating the devolved authority that each holding is situated in,
where: 1 = England 2 = Wales 3 = Scotland 4 = Northern Ireland.</p></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#List table names</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>sects <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;POULTRY&quot;</span>,<span class="st">&quot;CROP&quot;</span>,<span class="st">&quot;GRASS&quot;</span>,<span class="st">&quot;SHEEP&quot;</span>,<span class="st">&quot;PIG&quot;</span>,<span class="st">&quot;MINORLIVESTOCK&quot;</span>,<span class="st">&quot;CATTLE&quot;</span>)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#for(YEAR in 1990:2018){</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="cf">for</span>(sector <span class="cf">in</span> sects){</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="fu">agric_update_actv_tbl</span>(fl_lkup, <span class="at">sector =</span> sector)</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>}</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="fu">render_qaqc_doc</span>(<span class="at">out_fl =</span> <span class="st">&quot;~/QAQC_activity_data.html&quot;</span>, <span class="at">yr =</span> nw_yr, <span class="at">out_lstk =</span> T, <span class="at">out_fert =</span> T)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">INVENTORY</th>
<th align="right">YEAR</th>
<th align="left">HOLDING</th>
<th align="right">DB_CATEGORY</th>
<th align="right">COUNT</th>
<th align="right">COUNTRY</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">2023</td>
<td align="left">2-52-009-0010</td>
<td align="right">5</td>
<td align="right">529</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2023</td>
<td align="left">2-52-009-0012</td>
<td align="right">5</td>
<td align="right">112</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">2023</td>
<td align="left">2-52-009-0013</td>
<td align="right">5</td>
<td align="right">1067</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2023</td>
<td align="left">2-52-009-0035</td>
<td align="right">5</td>
<td align="right">58</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">2023</td>
<td align="left">2-52-009-0036</td>
<td align="right">5</td>
<td align="right">17</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2023</td>
<td align="left">2-52-009-0040</td>
<td align="right">5</td>
<td align="right">11</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">2023</td>
<td align="left">2-52-009-0042</td>
<td align="right">5</td>
<td align="right">355</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2023</td>
<td align="left">2-52-009-7999</td>
<td align="right">5</td>
<td align="right">33</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">2023</td>
<td align="left">2-52-009-9000</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2023</td>
<td align="left">2-52-010-0001</td>
<td align="right">5</td>
<td align="right">675</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
</div>
<div id="create-category-split-tables" class="section level3">
<h3>7 - Create Category “split” tables</h3>
<p>Some of the original JAS categories need to be separated into
sub-categories for the emission model. For example, in the English JAS
“Layers &amp; Pullets” are recorded as a single category but the
emission model needs “Layers” and “Pullets” separating into two
categories. First we need to create a table containing the merged
category ID (e.g. the ID corresponding to ‘Layers and Pullets’), the
sub-category IDs (e.g. IDs corresponding to ‘Layers’ and ‘Pullets’) and
the proportions associated with each sub-category.</p>
<table>
<thead>
<tr class="header">
<th align="left">DAUTH</th>
<th align="left">YEAR</th>
<th align="left">SECTOR</th>
<th align="right">DB_CATEGORY</th>
<th align="right">SPLIT</th>
<th align="right">PROP</th>
<th align="left">RFT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">EW</td>
<td align="left">2023</td>
<td align="left">CROP</td>
<td align="right">10</td>
<td align="right">11</td>
<td align="right">0.3400000</td>
<td align="left">ALL</td>
</tr>
<tr class="even">
<td align="left">EW</td>
<td align="left">2023</td>
<td align="left">CROP</td>
<td align="right">10</td>
<td align="right">12</td>
<td align="right">0.6600000</td>
<td align="left">ALL</td>
</tr>
<tr class="odd">
<td align="left">SC</td>
<td align="left">2023</td>
<td align="left">CROP</td>
<td align="right">10</td>
<td align="right">11</td>
<td align="right">0.6100000</td>
<td align="left">ALL</td>
</tr>
<tr class="even">
<td align="left">SC</td>
<td align="left">2023</td>
<td align="left">CROP</td>
<td align="right">10</td>
<td align="right">12</td>
<td align="right">0.3900000</td>
<td align="left">ALL</td>
</tr>
<tr class="odd">
<td align="left">EW</td>
<td align="left">2023</td>
<td align="left">CROP</td>
<td align="right">4</td>
<td align="right">5</td>
<td align="right">0.5100000</td>
<td align="left">ALL</td>
</tr>
<tr class="even">
<td align="left">EW</td>
<td align="left">2023</td>
<td align="left">CROP</td>
<td align="right">4</td>
<td align="right">6</td>
<td align="right">0.4900000</td>
<td align="left">ALL</td>
</tr>
<tr class="odd">
<td align="left">SC</td>
<td align="left">2023</td>
<td align="left">CROP</td>
<td align="right">4</td>
<td align="right">5</td>
<td align="right">0.7200000</td>
<td align="left">ALL</td>
</tr>
<tr class="even">
<td align="left">SC</td>
<td align="left">2023</td>
<td align="left">CROP</td>
<td align="right">4</td>
<td align="right">6</td>
<td align="right">0.2800000</td>
<td align="left">ALL</td>
</tr>
<tr class="odd">
<td align="left">EW</td>
<td align="left">2023</td>
<td align="left">CROP</td>
<td align="right">7</td>
<td align="right">8</td>
<td align="right">0.1800000</td>
<td align="left">ALL</td>
</tr>
<tr class="even">
<td align="left">EW</td>
<td align="left">2023</td>
<td align="left">CROP</td>
<td align="right">7</td>
<td align="right">9</td>
<td align="right">0.8200000</td>
<td align="left">ALL</td>
</tr>
<tr class="odd">
<td align="left">SC</td>
<td align="left">2023</td>
<td align="left">CROP</td>
<td align="right">7</td>
<td align="right">8</td>
<td align="right">0.3200000</td>
<td align="left">ALL</td>
</tr>
<tr class="even">
<td align="left">SC</td>
<td align="left">2023</td>
<td align="left">CROP</td>
<td align="right">7</td>
<td align="right">9</td>
<td align="right">0.6800000</td>
<td align="left">ALL</td>
</tr>
<tr class="odd">
<td align="left">ENG</td>
<td align="left">2023</td>
<td align="left">PIG</td>
<td align="right">7</td>
<td align="right">4</td>
<td align="right">0.1610290</td>
<td align="left">ALL</td>
</tr>
<tr class="even">
<td align="left">NI</td>
<td align="left">2023</td>
<td align="left">PIG</td>
<td align="right">7</td>
<td align="right">4</td>
<td align="right">0.1974248</td>
<td align="left">ALL</td>
</tr>
<tr class="odd">
<td align="left">ENG</td>
<td align="left">2023</td>
<td align="left">PIG</td>
<td align="right">7</td>
<td align="right">5</td>
<td align="right">0.5127325</td>
<td align="left">ALL</td>
</tr>
<tr class="even">
<td align="left">NI</td>
<td align="left">2023</td>
<td align="left">PIG</td>
<td align="right">7</td>
<td align="right">5</td>
<td align="right">0.4545431</td>
<td align="left">ALL</td>
</tr>
<tr class="odd">
<td align="left">ENG</td>
<td align="left">2023</td>
<td align="left">PIG</td>
<td align="right">7</td>
<td align="right">6</td>
<td align="right">0.3262385</td>
<td align="left">ALL</td>
</tr>
<tr class="even">
<td align="left">NI</td>
<td align="left">2023</td>
<td align="left">PIG</td>
<td align="right">7</td>
<td align="right">6</td>
<td align="right">0.3480321</td>
<td align="left">ALL</td>
</tr>
<tr class="odd">
<td align="left">ENG</td>
<td align="left">2023</td>
<td align="left">POULTRY</td>
<td align="right">11</td>
<td align="right">6</td>
<td align="right">0.3650246</td>
<td align="left">ALL</td>
</tr>
<tr class="even">
<td align="left">ENG</td>
<td align="left">2023</td>
<td align="left">POULTRY</td>
<td align="right">11</td>
<td align="right">7</td>
<td align="right">0.0218847</td>
<td align="left">ALL</td>
</tr>
<tr class="odd">
<td align="left">ENG</td>
<td align="left">2023</td>
<td align="left">POULTRY</td>
<td align="right">11</td>
<td align="right">8</td>
<td align="right">0.6130907</td>
<td align="left">ALL</td>
</tr>
<tr class="even">
<td align="left">ENG</td>
<td align="left">2023</td>
<td align="left">POULTRY</td>
<td align="right">10</td>
<td align="right">1</td>
<td align="right">0.2369817</td>
<td align="left">ALL</td>
</tr>
<tr class="odd">
<td align="left">ENG</td>
<td align="left">2023</td>
<td align="left">POULTRY</td>
<td align="right">10</td>
<td align="right">2</td>
<td align="right">0.7630183</td>
<td align="left">ALL</td>
</tr>
<tr class="even">
<td align="left">W</td>
<td align="left">2023</td>
<td align="left">POULTRY</td>
<td align="right">11</td>
<td align="right">6</td>
<td align="right">0.3650246</td>
<td align="left">ALL</td>
</tr>
<tr class="odd">
<td align="left">W</td>
<td align="left">2023</td>
<td align="left">POULTRY</td>
<td align="right">11</td>
<td align="right">7</td>
<td align="right">0.0218847</td>
<td align="left">ALL</td>
</tr>
<tr class="even">
<td align="left">W</td>
<td align="left">2023</td>
<td align="left">POULTRY</td>
<td align="right">11</td>
<td align="right">8</td>
<td align="right">0.6130907</td>
<td align="left">ALL</td>
</tr>
<tr class="odd">
<td align="left">W</td>
<td align="left">2023</td>
<td align="left">POULTRY</td>
<td align="right">10</td>
<td align="right">1</td>
<td align="right">0.2369817</td>
<td align="left">ALL</td>
</tr>
<tr class="even">
<td align="left">W</td>
<td align="left">2023</td>
<td align="left">POULTRY</td>
<td align="right">10</td>
<td align="right">2</td>
<td align="right">0.7630183</td>
<td align="left">ALL</td>
</tr>
<tr class="odd">
<td align="left">SC</td>
<td align="left">2023</td>
<td align="left">PIG</td>
<td align="right">7</td>
<td align="right">4</td>
<td align="right">0.2265018</td>
<td align="left">ALL</td>
</tr>
<tr class="even">
<td align="left">SC</td>
<td align="left">2023</td>
<td align="left">PIG</td>
<td align="right">7</td>
<td align="right">5</td>
<td align="right">0.4682978</td>
<td align="left">ALL</td>
</tr>
<tr class="odd">
<td align="left">SC</td>
<td align="left">2023</td>
<td align="left">PIG</td>
<td align="right">7</td>
<td align="right">6</td>
<td align="right">0.3052004</td>
<td align="left">ALL</td>
</tr>
</tbody>
</table>
</div>
<div id="write-final-scaled-tables" class="section level3">
<h3>8 - Write final scaled tables</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co"># Check scaled values read in correctly</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>scl_lkup <span class="ot">&lt;-</span> <span class="fu">mke_scale_lkup</span>()</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>sects <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;POULTRY&quot;</span>,<span class="st">&quot;CROP&quot;</span>,<span class="st">&quot;GRASS&quot;</span>,<span class="st">&quot;SHEEP&quot;</span>,<span class="st">&quot;PIG&quot;</span>,<span class="st">&quot;MINORLIVESTOCK&quot;</span>,<span class="st">&quot;CATTLE&quot;</span>)</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="cf">for</span>(DA <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&quot;ENG&quot;</span>,<span class="st">&quot;W&quot;</span>,<span class="st">&quot;SC&quot;</span>,<span class="st">&quot;NI&quot;</span>)){</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>  </span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>fl_lkup <span class="ot">&lt;-</span> JAS_file_ls[DAUTH <span class="sc">==</span> DA <span class="sc">&amp;</span> YEAR <span class="sc">==</span> nw_yr]</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#for(YEAR in 1990:2018){</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="cf">for</span>(sector <span class="cf">in</span> sects){</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="fu">agric_scaled_actv_data</span>(<span class="at">fl_lkup =</span> fl_lkup, <span class="at">sector =</span> sector)</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>}}</span></code></pre></div>
<div id="rft---calculation-and-final-check" class="section level4">
<h4>RFT - Calculation and final check</h4>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="cf">for</span>(DA <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&quot;ENG&quot;</span>,<span class="st">&quot;W&quot;</span>,<span class="st">&quot;SC&quot;</span>,<span class="st">&quot;NI&quot;</span>)){</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  </span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>fl_lkup <span class="ot">&lt;-</span> JAS_file_ls[DAUTH <span class="sc">==</span> DA <span class="sc">&amp;</span> YEAR <span class="sc">==</span> nw_yr]</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#for(YEAR in 1990:2018){</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="fu">agric_rft_calc</span>(fl_lkup)</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>}</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="fu">render_qaqc_doc</span>(<span class="at">out_fl =</span> <span class="st">&quot;~/QAQC_2023.html&quot;</span>, <span class="at">yr =</span> nw_yr, <span class="at">out_lstk =</span> T, <span class="at">out_fert =</span> T,</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>                <span class="at">out_locs =</span> T,<span class="at">out_rft =</span> T)</span></code></pre></div>
</div>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
